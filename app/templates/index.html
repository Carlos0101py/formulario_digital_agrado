{% extends "base.html" %}

{% block head %}

<title>Index</title>

{% endblock %}

{% block body %}

<script>

    function mostrar() {
        console.log(itenSelecionado);
    }

    var itenSelecionado = {
        itens: [],
        estampas: [],
        cores: [],
        fontes: [],
        nome: '',
        email: ''
    };

    const send_data = () => {

        console.log('entrou')

        fetch('/create_pdf', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ itens: itenSelecionado })
        })
            .then(response => response.json())
            .then(data => {
                console.log('Resposta do Flask:', data);
                alert(data['message'])
            })
            .catch(error => {
                console.error('Erro:', error);
            });
    }

    const selectOption = (valor, campo) => {

        switch (campo) {
            case 1:
                propriedade = 'itens'
                break;
            case 2:
                propriedade = 'estampas'
                break;
            case 3:
                propriedade = 'cores'
                break;
            case 4:
                propriedade = 'fontes'
                break;
            default:
                break;
        }

        var novoObjeto = { [propriedade]: valor };

        var index = itenSelecionado[propriedade].findIndex(item => item.nome === valor);

        if (index !== -1) {
            itenSelecionado[propriedade].splice(index, 1);
            console.log('Item removido:', valor);
        } else {
            itenSelecionado[propriedade].push(novoObjeto);
            console.log('Novo objeto adicionado:', novoObjeto);
        }

        mostrar();
    };

</script>

<div class="bg-green-900 flex flex-row justify-center font-bold text-xl text-white items-center h-[4rem]">
    <h1>Projeto-agrado</h1>
</div>

<div class=" flex justify-end mt-2">
    <div class="bg-green-900 rounded-md flex justify-center w-[5rem] p-2 mr-6">
        <button class="text-white font-bold" onclick="{send_data()}">Enviar</button>
    </div>
</div>

<div class="flex flex-col justify-center items-center py-4 gap-4">

    <section class="flex flex-col gap-3 w-[90%]">
        <div>
            <div>
                <span class="font-bold text-gray-500">Nome</span>
            </div>
            <div>
                <input id="nomeInput" class="border border-solid border-gray-400 rounded-lg w-full h-8 pl-2" type="text" placeholder="Nome...">
            </div>
        </div>
        <div>
            <div>
                <span class="font-bold text-gray-500">E-mail</span>
            </div>
            <div>
                <input id="emailInput" class="border border-solid border-gray-400 rounded-lg w-full h-8 pl-2" type="email" placeholder="E-mail...">
            </div>
        </div>
    </section>

    <section class="flex flex-col justify-center w-[90%] gap-2">

        <section class="flex items-start justify-start">
            <span class="font-bold text-gray-500">Produtos</span>
        </section>

        <div class="grid grid-cols-2 gap-2">
            {% for produto in itens['produtos']['itens'] %}
            <div onclick="selectOption('{{produto.nome}}', 1)" class="border border-solid rounded-md border-gray-400">
                <div class="">
                    <div class="bg-green-800 rounded-md">
                        <img src="https://placehold.co/200x250" alt="Imagem de capa"
                            class="w-full h-full object-cover rounded-t-md" />
                    </div>
                    <div class="flex justify-center p-1 rounded-b-md text-gray-500 hover:bg-green-900 hover:text-white">
                        <span class="font-bold">{{ produto.nome }}</span>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <section class="flex items-start justify-start">
            <span class="font-bold text-gray-500">Estampas</span>
        </section>

        <div class="grid grid-cols-2 gap-2">
            {% for produto in itens['produtos']['estampas'] %}
            <div onclick="selectOption('{{produto.nome}}', 2)" class="border border-solid rounded-md border-gray-400">
                <div class="">
                    <div class="bg-green-800 rounded-md">
                        <img src="https://placehold.co/200x250" alt="Imagem de capa"
                            class="w-full h-full object-cover rounded-t-md" />
                    </div>
                    <div class="flex justify-center p-1 rounded-b-md text-gray-500 hover:bg-green-900 hover:text-white">
                        <span class="font-bold">{{ produto.nome }}</span>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </section>
</div>

{% endblock %}